<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="default :: header"></head>

<body>
	<nav th:replace="default :: bar"></nav>
	<div class="container">
		<div id="accountMainDiv" class="container-fluid">
			<div id="dataAccountDiv" class="transparency">
				<h3>
					<img src="../img/iconoPet75.png" style="width: 38px; height: 38px;">
					Cuenta
				</h3>
				<hr style="border: 1px solid white !important;">
				<div class="form-group">
					<label><i style="color: turquoise" class="fas fa-user"></i> Nombre de usuario:</label>
					<p th:text="${user?.name}"></p>
				</div>

				<div class="form-group">
					<label><i style="color: turquoise" class="fas fa-envelope"></i>
						Email notificaciones de mascota:</label>
					<p th:text="${user?.email}"></p>
					<small style="color:turquoise">Las notificaciones de mascota incluyen la latitud y longitud de lectura, puede diferir de la casilla de activación donde recibió el código.</small>
				</div>
				
				<br>

				<div class="form-group">
					<h4>Panel de control Pet-QR:</h4>
					<hr style="border: 1px solid white !important;">
				</div>

				<div>
					<table id="accountTable"
						class="table table-dark table-responsive table-striped rounded">
						<thead>
							<tr>
								<td>Indice</td>
								<td>QR id</td>
								<td>Nombre Mascota</td>
								<td>Mail de activación</td>
								<td>Acciones</td>
								<td>Diseños</td>
								<td>Alerta</td>
							</tr>
						</thead>
				 <!--/*/ <th:block th:each="listIterate ,iStat : ${list}"> /*/-->
						<tbody>
							<tr>
								<td th:text="${iStat?.count}"></td>
								<td><a th:href="@{'/id/'+${list[iStat?.index].id}}"
									th:id="'idValue'+${iStat?.index}"
									th:text="${list[iStat?.index].id}"></a></td>
								<td th:text="${listIterate?.pet?.petName}"></td>
								<td th:text="${list[iStat?.index].selledOnline}"></td>
								<td><a th:href="@{'/id/'+${list[iStat?.index].id}}"><i
										style="color: lightgreen" class="fas fa-search"></i></a> <a
									th:href="@{'/prepaid-qr?idValue='+${list[iStat?.index].id}+'&selledOnlineValue='+${list[iStat?.index].selledOnline}}"><i
										style="color: PaleTurquoise" class="fas fa-edit"></i></a> <a href="#" onclick="deleteQr()"><i class="far fa-trash-alt" style="color: tomato"></i> <a th:onclick="transferCode()" href="#" ><i class="fas fa-exchange-alt" style="color:DarkViolet"></i></a></td> 
										<!-- Form button to send object to download page -->
										<td>
											<form action="#" th:action="@{/download}" th:method="POST" th:object="${prepaidQR}">
													<button type="submit" class="btn btn-sm btn-info"><i class="fas fa-download"></i></button>
													<input type="hidden" th:value="${list[iStat?.index].id}" id="id" name="id" />
													<input type="hidden" th:value="${list[iStat?.index].strBase64}" id="strBase64" name="strBase64" />
													<input type="hidden" th:value="${list[iStat?.index].resultBase64Avatar}" id="resultBase64Avatar" name="resultBase64Avatar" />
											</form>
										</td>
										<td>
											<form th:if="${list[iStat?.index]?.pet?.status == true}" action="#" th:action="@{/emergency}" method="GET" th:object="${prepaidQR}" style="display:inline">
												<button class="btn btn-sm btn-danger">
													<i style="color: pink" class="fas fa-exclamation-triangle"></i>
												</button>
											<input type="hidden" th:value="${list[iStat?.index].id}" id="id" name="id">
											</form>
											
											<form th:if="${list[iStat?.index]?.pet?.status == false}" action="#" th:action="@{/rescued}" method="GET" th:object="${prepaidQR}" style="display:inline">
												<button class="btn btn-sm btn-success">
													<i style="color: pink" class="fas fa-exclamation-triangle"></i>
												</button>
											<input type="hidden" th:value="${list[iStat?.index].id}" name="id">
											</form>
										</td>
										
										<script th:inline="javascript">
										function transferCode(idPrepaidQR){
											var idPrepaidQR = [[${list[iStat?.index].id.toString()}]];
											console.log(idPrepaidQR);
											
											$.confirm({
												theme:"bootstrap",
												title:"Tranferir código a otro usuario <i class='fas fa-exchange-alt' style='color:DarkViolet'></i>",
												content:"Cuándo sirve esta opción?<br><ol><li>Cuando querés transferirlo por venta.</li><li>Cuando sabés que no vas a tener más mascota</li><li>Cuando querés darlo en forma de regalo.</li><li>Cuando el que lo quiere no puede pagar por los medios disponibles.</li><li>Esta opción es irreversible como la eliminación.</li></ol><label><i class='fas fa-user' style='color:LimeGreen''></i> Usuario Activo Destinatario:</label><input type='text' id='emailDestinatary' style='background-color:pink; text-align:center; margin: 0 auto;' placeholder='Email del destinatario'>",
												buttons:{
													confirm: function(){
														var xhr = new XMLHttpRequest();
														var emailDestinatary = document.getElementById("emailDestinatary").value;
														var url = "/transfer?emailDestinatary="+emailDestinatary+"&idPrepaidQR="+idPrepaidQR;

															xhr.onreadystatechange = function () {
															if (xhr.readyState == 4 && xhr.status == 200) {
																$.alert({
																	title: "Respuesta del servidor",
																	theme: "bootstrap",																	
																	content: xhr.responseText,
																	buttons:{
																		confirm: function(){
																			location.reload();
																		}
																	}
																});
															}
														}	
													xhr.open("GET", url, true);
													xhr.send();
													},
													cancel: function(){
													
													}
												}
												
											});
											
											
											
										}
										</script>
									
								<script>
									function deleteQr() {
										$
												.confirm({
													type : "red",
													title : 'Confirme la eliminación!',
													content : "<html><p>Confirma que desea Borrar el QR con id:   <strong>[[${list[iStat?.index].id}]]</strong>?</p><p style='text-align:justify'>Tenga en cuenta que está interactuando con nuestro servidor por ende los datos no podrán ser recuperados</p></html>",
													buttons : {
														confirm : {
															text : 'Borrar',
															btnClass : 'btn-red',
															keys : [ 'enter',
																	'shift' ],
															action : function() {
																$
																		.alert('Confirmada eliminación de QR!, los datos No podrán ser recuperados}');
																window.location.href = "[[@{'/delete?id='+${list[iStat?.index].id}}]]"
															}
														},
														cancel : function() {
															$
																	.alert({
																		type : "blue",
																		title : "Acción:",
																		content : 'Cancelada'
																	});
														}

													}
												});
									}
								</script>
							</tr>
						</tbody>
					</table>
				<!--/*/ </th:block> /*/-->
				<br>
				<br>

				<br> <br> <br> <br>
			</div>
		</div>

		<footer th:replace="default :: footer"></footer>
	</div>
</body>

</html>