<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="default :: header"></head>

<body onload="findPrepaidQR()">
    <ul th:replace="default :: bar"></ul>
    <br>
    <br>
    <div id="prepaidMainDiv">
        <h2><i class="fas fa-paw"></i> Activar QR <i class="fas fa-qrcode"></i></h2>

        <br>

        <h5> Ingrese código de activación</h5>

        <form action="#" th:action="@{/prepaid-qr}" th:object="${prepaidQR}" method="POST">
            <input type="text" th:field="*{id}" id="id" onkeyup="findPrepaidQR()" required />

            <br>
            <label><i class="fas fa-paw"></i></label>
            <small style="color:pink">Código alfanumérico único de 20 caractéres impreso en la cinta.</small>
            <label><i class="fas fa-paw"></i></label>
            <br>
            <br>
            <div id="resultImage"></div>
            <br>
            <button class="btn btn-danger" type="submit">Activar QR</button>
        </form>
        <br>
    </div>
    <div th:replace="default :: footer"></div>
</body>(


<script>
    function findPrepaidQR() {
        var xhr = new XMLHttpRequest();
        var url = "/findPrepaidQrBySpecialId";
        var id = document.getElementById("id").value;

        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr.send("id=" + id);

        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {

                var createImage = document.createElement("img");
                var divResult = document.getElementById("resultImage");
                var attribute = document.createAttribute("src");
                attribute.value = "data:image/png;base64, " + xhr.responseText;
                createImage.setAttributeNode(attribute);
                var shadowStyle = document.createAttribute("style");
                shadowStyle.value = "box-shadow: 0px 0px 45px black; border-radius: 10px";
                createImage.setAttributeNode(shadowStyle);
                
                divResult.appendChild(createImage);

                document.onkeydown = function(){
                    divResult.removeChild(createImage);
                    divResult.removeChild(createImage);
                }
            }
        }
    }
</script>

</html>